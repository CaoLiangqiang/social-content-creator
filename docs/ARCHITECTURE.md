# è½¯ä»¶æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„æ¨¡å¼
é‡‡ç”¨**å¾®æœåŠ¡æ¶æ„** + **äº‹ä»¶é©±åŠ¨æ¶æ„**çš„è®¾è®¡æ¨¡å¼ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æ¥å…¥å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Web UI   â”‚  â”‚ API SDK  â”‚  â”‚ CLI Tool â”‚  â”‚ Mobile   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API ç½‘å…³å±‚ (Nginx + API Gateway)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸šåŠ¡æœåŠ¡å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ç”¨æˆ·æœåŠ¡  â”‚  â”‚å†…å®¹æœåŠ¡  â”‚  â”‚åˆ†ææœåŠ¡  â”‚  â”‚å‘å¸ƒæœåŠ¡  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚çˆ¬è™«æœåŠ¡  â”‚  â”‚AIç”ŸæˆæœåŠ¡â”‚  â”‚é€šçŸ¥æœåŠ¡  â”‚  â”‚ç»Ÿè®¡æœåŠ¡  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å¤„ç†å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚æ¶ˆæ¯é˜Ÿåˆ—  â”‚  â”‚ç¼“å­˜å±‚    â”‚  â”‚æœç´¢å¼•æ“  â”‚  â”‚æ–‡ä»¶å­˜å‚¨  â”‚       â”‚
â”‚  â”‚(Redis)   â”‚  â”‚(Redis)   â”‚  â”‚(ES)      â”‚  â”‚(MinIO)   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å­˜å‚¨å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚PostgreSQLâ”‚  â”‚ MongoDB  â”‚  â”‚Redis     â”‚  â”‚S3/MinIO  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒæœåŠ¡æ¨¡å—è®¾è®¡

### 1. ç”¨æˆ·æœåŠ¡ (User Service)
**èŒè´£**: ç”¨æˆ·è®¤è¯ã€æˆæƒã€ç®¡ç†
```typescript
interface IUserService {
  register(userData: RegisterDTO): Promise<User>
  login(credentials: LoginDTO): Promise<Token>
  updateProfile(userId: string, data: ProfileDTO): Promise<User>
  deleteAccount(userId: string): Promise<void>
}
```

### 2. çˆ¬è™«æœåŠ¡ (Crawler Service)
**èŒè´£**: å¤šå¹³å°æ•°æ®é‡‡é›†
```typescript
interface ICrawlerService {
  crawlXiaohongshu(keyword: string, limit: number): Promise<Content[]>
  crawlBilibili(keyword: string, limit: number): Promise<VideoContent[]>
  crawlWeibo(topic: string, limit: number): Promise<WeiboContent[]>
  scheduleCrawl(platform: Platform, cron: string): Promise<Job>
}
```

### 3. åˆ†ææœåŠ¡ (Analysis Service)
**èŒè´£**: å†…å®¹åˆ†æã€è¶‹åŠ¿è¯†åˆ«
```typescript
interface IAnalysisService {
  analyzeSentiment(content: string): Promise<SentimentResult>
  extractKeywords(content: string): Promise<string[]>
  calculateTrendingScore(content: Content): Promise<number>
  generateInsights(contents: Content[]): Promise<InsightReport>
}
```

### 4. AIç”ŸæˆæœåŠ¡ (AI Generation Service)
**èŒè´£**: æ™ºèƒ½å†…å®¹ç”Ÿæˆ
```typescript
interface IAIGenerationService {
  generateXiaohongshuContent(original: Content): Promise<GeneratedContent>
  optimizeContent(content: string, platform: Platform): Promise<OptimizedContent>
  generateTitle(content: string, style: TitleStyle): Promise<string[]>
  suggestTags(content: string): Promise<string[]>
}
```

### 5. å‘å¸ƒæœåŠ¡ (Publishing Service)
**èŒè´£**: å†…å®¹å‘å¸ƒç®¡ç†
```typescript
interface IPublishingService {
  schedulePublish(content: GeneratedContent, time: Date): Promise<Schedule>
  publishToPlatform(platform: Platform, content: Content): Promise<PublishResult>
  batchPublish(contents: Content[]): Promise<PublishResult[]>
  monitorPublishStatus(publishId: string): Promise<PublishStatus>
}
```

---

## ğŸ”§ æŠ€æœ¯æ ˆè¯¦ç»†è®¾è®¡

### åç«¯æŠ€æœ¯æ ˆ

#### æ ¸å¿ƒæ¡†æ¶
```json
{
  "framework": "Express.js + TypeScript",
  "version": "4.18.x",
  "reason": "æˆç†Ÿç¨³å®šã€ç”Ÿæ€ä¸°å¯Œã€ç±»å‹å®‰å…¨"
}
```

#### æ•°æ®åº“é€‰æ‹©
```yaml
PostgreSQL:
  ç”¨é€”: ä¸»æ•°æ®å­˜å‚¨
  ç‰ˆæœ¬: 15.x
  åŸå› : ACIDæ”¯æŒã€å¤æ‚æŸ¥è¯¢ã€JSONç±»å‹

MongoDB:
  ç”¨é€”: åŸå§‹çˆ¬è™«æ•°æ®å­˜å‚¨
  ç‰ˆæœ¬: 6.x
  åŸå› : çµæ´»schemaã€é«˜æ€§èƒ½å†™å…¥

Redis:
  ç”¨é€”: ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¼šè¯å­˜å‚¨
  ç‰ˆæœ¬: 7.x
  åŸå› : é«˜æ€§èƒ½ã€ä¸°å¯Œæ•°æ®ç»“æ„

Elasticsearch:
  ç”¨é€”: å…¨æ–‡æœç´¢ã€æ—¥å¿—åˆ†æ
  ç‰ˆæœ¬: 8.x
  åŸå› : å¼ºå¤§çš„æœç´¢èƒ½åŠ›ã€å®æ—¶åˆ†æ
```

#### æ¶ˆæ¯é˜Ÿåˆ—
```typescript
{
  "queue": "Bull Queue",
  "backend": "Redis",
  "features": ["ä»»åŠ¡è°ƒåº¦", "é‡è¯•æœºåˆ¶", "ä¼˜å…ˆçº§é˜Ÿåˆ—", "å»¶è¿Ÿä»»åŠ¡"],
  "use_cases": ["å¼‚æ­¥çˆ¬è™«", "å†…å®¹ç”Ÿæˆ", "é‚®ä»¶å‘é€", "æ•°æ®æ¸…ç†"]
}
```

#### AIæœåŠ¡é›†æˆ
```typescript
interface AIServiceConfig {
  openai: {
    apiKey: string
    model: "gpt-4" | "gpt-3.5-turbo"
    maxTokens: 2000
    temperature: 0.7
  }
  localModels: {
    sentiment: "transformers.js"
    keywords: "natural"
    translation: "libretranslate"
  }
}
```

### å‰ç«¯æŠ€æœ¯æ ˆ

#### æ ¸å¿ƒæ¡†æ¶
```json
{
  "framework": "React 18",
  "language": "TypeScript",
  "build": "Vite",
  "styling": "TailwindCSS",
  "ui_library": "Ant Design"
}
```

#### çŠ¶æ€ç®¡ç†
```typescript
{
  "state_management": "Redux Toolkit",
  "middleware": ["redux-saga", "redux-logger"],
  "cache": "React Query (TanStack Query)"
}
```

#### æ•°æ®å¯è§†åŒ–
```typescript
{
  "charts": "ECharts",
  "realtime": "WebSocket + Socket.io",
  "tables": "Ant Design Table + Virtual Scroll"
}
```

---

## ğŸ—„ï¸ æ•°æ®åº“è¯¦ç»†è®¾è®¡

### PostgreSQL Schema

#### ç”¨æˆ·ç›¸å…³è¡¨
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role VARCHAR(20) DEFAULT 'user',
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP
);

-- ç”¨æˆ·é…ç½®è¡¨
CREATE TABLE user_preferences (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    preferences JSONB DEFAULT '{}',
    notification_settings JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### å¹³å°ç›¸å…³è¡¨
```sql
-- å¹³å°è¡¨
CREATE TABLE platforms (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(50) UNIQUE NOT NULL,
    display_name VARCHAR(100) NOT NULL,
    base_url VARCHAR(255) NOT NULL,
    api_config JSONB DEFAULT '{}',
    rate_limit INTEGER DEFAULT 100,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å¹³å°è´¦å·è¡¨
CREATE TABLE platform_accounts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    platform_id UUID REFERENCES platforms(id) ON DELETE CASCADE,
    account_name VARCHAR(100),
    credentials JSONB NOT NULL,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, platform_id, account_name)
);
```

#### å†…å®¹ç›¸å…³è¡¨
```sql
-- çˆ¬å–å†…å®¹è¡¨
CREATE TABLE crawled_contents (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    platform_id UUID REFERENCES platforms(id),
    content_url VARCHAR(500) UNIQUE NOT NULL,
    title VARCHAR(500),
    content TEXT,
    author VARCHAR(100),
    author_id VARCHAR(100),
    publish_date TIMESTAMP,
    crawled_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- äº’åŠ¨æ•°æ®
    likes_count INTEGER DEFAULT 0,
    comments_count INTEGER DEFAULT 0,
    shares_count INTEGER DEFAULT 0,
    views_count INTEGER DEFAULT 0,
    
    -- å…ƒæ•°æ®
    tags TEXT[] DEFAULT '{}',
    images TEXT[] DEFAULT '{}',
    videos TEXT[] DEFAULT '{}',
    metadata JSONB DEFAULT '{}',
    
    -- çŠ¶æ€
    is_processed BOOLEAN DEFAULT false,
    is_deleted BOOLEAN DEFAULT false,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç”Ÿæˆå†…å®¹è¡¨
CREATE TABLE generated_contents (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    source_content_id UUID REFERENCES crawled_contents(id),
    platform_id UUID REFERENCES platforms(id),
    
    -- ç”Ÿæˆçš„å†…å®¹
    generated_title VARCHAR(500),
    generated_content TEXT,
    generated_tags TEXT[] DEFAULT '{}',
    
    -- è´¨é‡è¯„åˆ†
    quality_score DECIMAL(3,2),
    relevance_score DECIMAL(3,2),
    originality_score DECIMAL(3,2),
    
    -- çŠ¶æ€
    status VARCHAR(20) DEFAULT 'draft',
    is_published BOOLEAN DEFAULT false,
    
    -- å‘å¸ƒä¿¡æ¯
    scheduled_at TIMESTAMP,
    published_at TIMESTAMP,
    publish_result JSONB,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### åˆ†æç›¸å…³è¡¨
```sql
-- åˆ†æç»“æœè¡¨
CREATE TABLE analysis_results (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    content_id UUID REFERENCES crawled_contents(id),
    
    -- åˆ†æç»“æœ
    sentiment_score DECIMAL(3,2), -- -1.0 to 1.0
    sentiment_label VARCHAR(20), -- positive, negative, neutral
    keywords TEXT[] DEFAULT '{}',
    keyphrases TEXT[] DEFAULT '{}',
    topics TEXT[] DEFAULT '{}',
    
    -- è¶‹åŠ¿åˆ†æ
    trending_score DECIMAL(5,2),
    viral_potential DECIMAL(3,2),
    engagement_prediction DECIMAL(3,2),
    
    -- è´¨é‡åˆ†æ
    content_quality DECIMAL(3,2),
    readability_score DECIMAL(3,2),
    
    -- å…ƒæ•°æ®
    analysis_version VARCHAR(20),
    analyzed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    metadata JSONB DEFAULT '{}'
);

-- çƒ­é—¨è¯é¢˜è¡¨
CREATE TABLE trending_topics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    platform_id UUID REFERENCES platforms(id),
    topic_name VARCHAR(200) NOT NULL,
    topic_hash VARCHAR(64) UNIQUE,
    
    -- ç»Ÿè®¡æ•°æ®
    mention_count INTEGER DEFAULT 0,
    engagement_count INTEGER DEFAULT 0,
    growth_rate DECIMAL(5,2),
    
    -- åˆ†ç±»
    category VARCHAR(50),
    tags TEXT[] DEFAULT '{}',
    
    -- æ—¶é—´æ•°æ®
    first_seen TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    peak_time TIMESTAMP,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- çŠ¶æ€
    is_active BOOLEAN DEFAULT true,
    trending_level INTEGER DEFAULT 0 -- 1-5çº§
);
```

#### ä»»åŠ¡ç›¸å…³è¡¨
```sql
-- çˆ¬è™«ä»»åŠ¡è¡¨
CREATE TABLE crawler_tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    platform_id UUID REFERENCES platforms(id),
    
    -- ä»»åŠ¡é…ç½®
    task_name VARCHAR(200),
    task_type VARCHAR(50), -- keyword, user, topic
    target_config JSONB NOT NULL,
    
    -- è°ƒåº¦é…ç½®
    schedule_type VARCHAR(20), -- once, daily, weekly, custom
    cron_expression VARCHAR(100),
    next_run TIMESTAMP,
    
    -- çŠ¶æ€
    status VARCHAR(20) DEFAULT 'pending',
    last_run TIMESTAMP,
    last_result JSONB,
    
    -- ç»Ÿè®¡
    total_runs INTEGER DEFAULT 0,
    success_runs INTEGER DEFAULT 0,
    failed_runs INTEGER DEFAULT 0,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å‘å¸ƒä»»åŠ¡è¡¨
CREATE TABLE publishing_tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    content_id UUID REFERENCES generated_contents(id),
    platform_id UUID REFERENCES platforms(id),
    platform_account_id UUID REFERENCES platform_accounts(id),
    
    -- å‘å¸ƒé…ç½®
    scheduled_time TIMESTAMP NOT NULL,
    timezone VARCHAR(50) DEFAULT 'Asia/Shanghai',
    
    -- çŠ¶æ€
    status VARCHAR(20) DEFAULT 'scheduled',
    result JSONB,
    error_message TEXT,
    
    -- æ‰§è¡Œä¿¡æ¯
    attempts INTEGER DEFAULT 0,
    max_attempts INTEGER DEFAULT 3,
    executed_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### MongoDB Schema

#### åŸå§‹æ•°æ®å­˜å‚¨
```javascript
// çˆ¬è™«åŸå§‹æ•°æ®
{
  _id: ObjectId,
  platform: String,
  content_type: String,
  raw_data: Object,
  html_content: String,
  screenshots: [String],
  metadata: {
    crawled_at: Date,
    crawler_version: String,
    user_agent: String,
    proxy_used: String
  },
  processing_status: {
    cleaned: Boolean,
    analyzed: Boolean,
    archived: Boolean
  }
}

// çˆ¬è™«æ—¥å¿—
{
  _id: ObjectId,
  task_id: String,
  platform: String,
  level: String, // info, warning, error
  message: String,
  details: Object,
  timestamp: Date,
  performance_metrics: {
    duration: Number,
    memory_usage: Number,
    success_rate: Number
  }
}
```

---

## ğŸ”„ APIè®¾è®¡è§„èŒƒ

### RESTful APIè®¾è®¡åŸåˆ™
```
GET    /api/v1/resources           # è·å–èµ„æºåˆ—è¡¨
GET    /api/v1/resources/:id       # è·å–å•ä¸ªèµ„æº
POST   /api/v1/resources           # åˆ›å»ºèµ„æº
PUT    /api/v1/resources/:id       # æ›´æ–°èµ„æº
DELETE /api/v1/resources/:id       # åˆ é™¤èµ„æº
PATCH  /api/v1/resources/:id       # éƒ¨åˆ†æ›´æ–°èµ„æº
```

### æ ¸å¿ƒAPIç«¯ç‚¹è®¾è®¡

#### ç”¨æˆ·ç›¸å…³API
```
POST   /api/v1/auth/register       # ç”¨æˆ·æ³¨å†Œ
POST   /api/v1/auth/login          # ç”¨æˆ·ç™»å½•
POST   /api/v1/auth/logout         # ç”¨æˆ·ç™»å‡º
GET    /api/v1/users/profile       # è·å–ç”¨æˆ·ä¿¡æ¯
PUT    /api/v1/users/profile       # æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```

#### å†…å®¹ç›¸å…³API
```
GET    /api/v1/contents            # è·å–å†…å®¹åˆ—è¡¨
GET    /api/v1/contents/:id        # è·å–å†…å®¹è¯¦æƒ…
POST   /api/v1/contents/crawl      # å¯åŠ¨çˆ¬è™«ä»»åŠ¡
GET    /api/v1/contents/trending   # è·å–çƒ­é—¨å†…å®¹
```

#### åˆ†æç›¸å…³API
```
POST   /api/v1/analysis/analyze    # åˆ†æå†…å®¹
GET    /api/v1/analysis/results/:id # è·å–åˆ†æç»“æœ
GET    /api/v1/analysis/insights   # è·å–åˆ†ææ´å¯Ÿ
```

#### ç”Ÿæˆç›¸å…³API
```
POST   /api/v1/generate/content   # ç”Ÿæˆå†…å®¹
GET    /api/v1/generate/templates  # è·å–æ¨¡æ¿åˆ—è¡¨
POST   /api/v1/generate/optimize   # ä¼˜åŒ–å†…å®¹
```

---

## ğŸ” å®‰å…¨è®¾è®¡

### è®¤è¯æˆæƒæœºåˆ¶
```typescript
// JWT Tokenç»“æ„
interface JWTToken {
  user_id: string
  username: string
  role: string
  permissions: string[]
  iat: number
  exp: number
}

// æƒé™çº§åˆ«
enum UserRole {
  ADMIN = 'admin',           // ç³»ç»Ÿç®¡ç†å‘˜
  USER = 'user',             // æ™®é€šç”¨æˆ·
  PREMIUM = 'premium'        // é«˜çº§ç”¨æˆ·
}

// æƒé™å®šä¹‰
const permissions = {
  content: {
    read: 'content:read',
    write: 'content:write',
    delete: 'content:delete'
  },
  crawler: {
    run: 'crawler:run',
    manage: 'crawler:manage'
  },
  ai: {
    generate: 'ai:generate',
    optimize: 'ai:optimize'
  }
}
```

### æ•°æ®å®‰å…¨
```yaml
åŠ å¯†æªæ–½:
  ä¼ è¾“: HTTPS/TLS 1.3
  å­˜å‚¨: AES-256åŠ å¯†æ•æ„Ÿæ•°æ®
  å¯†ç : bcrypt hash (salt rounds: 10)

æ•°æ®ä¿æŠ¤:
  ä¸ªäººä¿¡æ¯: æ•°æ®è„±æ•
  APIå¯†é’¥: ç¯å¢ƒå˜é‡éš”ç¦»
  æ—¥å¿—è®°å½•: æ•æ„Ÿä¿¡æ¯è¿‡æ»¤
```

### APIé™æµç­–ç•¥
```typescript
// é™æµé…ç½®
const rateLimitConfig = {
  windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
  maxRequests: {
    default: 100,
    premium: 500,
    admin: 1000
  },
  skipSuccessfulRequests: false,
  skipFailedRequests: false
}

// ç‰¹æ®Šç«¯ç‚¹é™æµ
const specialLimits = {
  '/api/v1/contents/crawl': { max: 10, windowMs: 60000 }, // æ¯åˆ†é’Ÿ10æ¬¡
  '/api/v1/generate/content': { max: 20, windowMs: 3600000 }, // æ¯å°æ—¶20æ¬¡
  '/api/v1/auth/login': { max: 5, windowMs: 900000 } // 15åˆ†é’Ÿ5æ¬¡
}
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### ç¼“å­˜ç­–ç•¥
```typescript
// å¤šçº§ç¼“å­˜æ¶æ„
const cacheStrategy = {
  L1: {
    type: 'memory',
    ttl: 300, // 5åˆ†é’Ÿ
    maxSize: '100MB'
  },
  L2: {
    type: 'redis',
    ttl: 3600, // 1å°æ—¶
    maxSize: '1GB'
  },
  L3: {
    type: 'cdn',
    ttl: 86400, // 24å°æ—¶
    maxSize: '10GB'
  }
}

// ç¼“å­˜é”®è®¾è®¡
const cacheKeys = {
  user: (userId: string) => `user:${userId}`,
  content: (contentId: string) => `content:${contentId}`,
  trending: (platform: string) => `trending:${platform}`,
  analysis: (contentId: string) => `analysis:${contentId}`
}
```

### æ•°æ®åº“ä¼˜åŒ–
```sql
-- ç´¢å¼•ç­–ç•¥
CREATE INDEX idx_contents_platform ON crawled_contents(platform_id);
CREATE INDEX idx_contents_created ON crawled_contents(created_at DESC);
CREATE INDEX idx_contents_tags ON crawled_contents USING GIN(tags);
CREATE INDEX idx_analysis_sentiment ON analysis_results(sentiment_score);
CREATE INDEX idx_tasks_next_run ON crawler_tasks(next_run);

-- åˆ†åŒºç­–ç•¥
CREATE TABLE crawled_contents_partitioned (
    -- å­—æ®µå®šä¹‰åŒä¸Š
) PARTITION BY RANGE (created_at);

-- åˆ›å»ºåˆ†åŒº
CREATE TABLE contents_2026_01 PARTITION OF crawled_contents_partitioned
    FOR VALUES FROM ('2026-01-01') TO ('2026-02-01');
```

### å¼‚æ­¥å¤„ç†
```typescript
// æ¶ˆæ¯é˜Ÿåˆ—ä»»åŠ¡å®šä¹‰
interface QueueJob {
  name: string
  data: any
  options: {
    attempts: number
    backoff: number
    delay: number
    priority: number
  }
}

// ä»»åŠ¡ä¼˜å…ˆçº§
const jobPriority = {
  HIGH: 1,    // ç”¨æˆ·äº¤äº’ä»»åŠ¡
  MEDIUM: 2,  // å®šæ—¶ä»»åŠ¡
  LOW: 3      // æ•°æ®æ¸…ç†ä»»åŠ¡
}
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### Dockerå®¹å™¨åŒ–
```yaml
# docker-compose.yml ç»“æ„
services:
  frontend:
    build: ./frontend
    ports: ["3000:3000"]
    environment:
      - NODE_ENV=production
      
  backend:
    build: ./backend
    ports: ["4000:4000"]
    depends_on:
      - postgres
      - redis
      
  postgres:
    image: postgres:15
    volumes:
      - postgres_data:/var/lib/postgresql/data
      
  redis:
    image: redis:7
    volumes:
      - redis_data:/data
      
  nginx:
    image: nginx:alpine
    ports: ["80:80", "443:443"]
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
```

### ç›‘æ§ç³»ç»Ÿ
```typescript
// ç›‘æ§æŒ‡æ ‡
const metrics = {
  application: {
    request_count: 'Counter',
    response_time: 'Histogram',
    error_rate: 'Gauge'
  },
  system: {
    cpu_usage: 'Gauge',
    memory_usage: 'Gauge',
    disk_io: 'Counter'
  },
  business: {
    daily_active_users: 'Gauge',
    content_generation_count: 'Counter',
    crawler_success_rate: 'Gauge'
  }
}
```

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0*  
*åˆ›å»ºæ—¥æœŸ: 2026-02-12*  
*æœ€åæ›´æ–°: 2026-02-12*  
*ç»´æŠ¤è€…: æ™ºå® (AIåŠ©æ‰‹)*